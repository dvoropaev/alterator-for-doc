Это не законченные документы только наработки требующие обсуждения и Доработки.
____
# Alterator-manager Спецификация

- [Alterator-manager Спецификация](#alterator-manager-спецификация)
  - [Введение](#введение)
  - [Именование файлов](#именование-файлов)
    - [Идентификатор Alterator entry](#идентификатор-alterator-entry)
  - [Базовый формат файла](#базовый-формат-файла)
    - [Комментарии](#комментарии)
    - [Заголовки групп](#заголовки-групп)
    - [Записи](#записи)
  - [Возможные типы значений](#возможные-типы-значений)
  - [Локализация значений для ключей](#локализация-значений-для-ключей)
  - [Общепринятые Alterator Entry ключи](#общепринятые-alterator-entry-ключи)
  - [Ключ Exec Исполнение-запуск](#ключ-exec-исполнение-запуск)
  - [Расширение формата](#расширение-формата)
  - [Подробнее о сущностях](#подробнее-о-сущностях)
    - [Сущность типа Application](#сущность-типа-application)
      - [Примеры](#примеры-application)
    - [Сущность типа Category](#сущность-типа-category)
      - [Примеры](#примеры-category)
    - [Сущность типа Object](#сущность-типа-object)
      - [Замещения](#замещения-object)
      - [Примеры](#примеры-object)
    - [Сущность типа Diag или Diagnostictool](#сущность-типа-diag-или-diagnostictool)
      - [Примеры](#примеры-diagnostictool)
    - [Сущность типа Backend](#сущность-типа-backend)
      - [Примеры](#примеры-backend)
    - [Сущность типа Component](#сущность-типа-component)
      - [Примеры](#примеры-component)
    - [Сущность типа Service](#сущность-типа-service)
      - [Примеры](#примеры-service)
  - [Объект /org/altlinux/alterator/global](#объект-rubasealtalteratorglobal)
  
## Введение
`Alterator Entry` - спецификация на дескриптор определяющий формат вывода сущности Alterator.
Сущность Alterator - механизмы предоставляющие через D-Bus интерфейсы и объекты.
Формат `Alterator Entry` является подмножеством популярного формата конфигурационных файлов `TOML`. Данная спецификация использует понятия описанные в [полной спецификации формата `TOML`](https://toml.io/en/v1.0.0).

## Именование файлов
Для упрощения навигации и разбора файлы Alterator Entry должны заканчиваться на `.<Type>` - расширение файла,
 где `<Type>` значение ключа `Type =` Alterator Entry с маленькой буквы. Исключение составляет тип diagnostictool,
 который разрешено сокращать до `diag` для упрощения написания. Оба варианта `diag` и `diagnostictool` считаются верными.
 Спецификации не рекомендует разбор(интерпретацию) файлов, не включающих необходимые расширения.
 
На данный момент существуют расширения:
- .application
- .backend
- .category
- .diag | .diagnostictool
- .object (описание сущностей)
- .service

Файл с описанием сущности рекомендовано назвать `<Name>.<Type>`; для backend -
`<Name>.<Interface(short-interface)|(full-interface)>.<Type>`:
 - full-interface  `org.altlinux.alterator.some_interface`
 - short-interface  `some_interface`

**Пример**
 - `some_name.org.altlinux.alterator.legacy.backend`
 - `some_name.legacy.backend`

### Идентификатор Alterator entry

Каждый файл описывает сущность Alterator по их типу и предполагает расположение по определенному пути в зависимости от типа.
Для различных сущностей Alterator пути различаются.

На данный момент зафиксированные сущности Alterator Entry:
- Application
- Backend
- Category
- Diag
- Object
- Component
- Service

В общем виде пути формируются по принципу:

Для сущностей притягиваемых с пакетами дистрибутива:
```/usr/share/alterator/<имя директория сущности>/<уникальное имя сущности>.<расширение>```

Изменяемые-конфигурируемые сущности или сущности создаваемые средствами пользователей для расширения функционала:
```/etc/alterator/<имя директория сущности>/<уникальное имя сущности>.<расширение>```

| **Имя сущности** | **Имя директории сущности** |
|:-----------------|:----------------------------|
| Application      | applications                |
| Backend          | backends                    |
| Category         | categories                  |
| Diag/Diagnostictool| diags                       |
| Object           | objects                     |
| Service          | services                    |
| Component        | components                  |

**Пример:**
```
/usr/share/alterator/applications/adt.application
```
Сущности Alterator Entry backend обладают режимами работы `{system|user}`. Сущности Alterator Entry backend в режиме
`user` складываются в подкаталог `backends/user/`. Сущности Alterator Entry backend в режиме `system` складываются в
соответствии со стандартом спецификации.

**Пример:** ```/usr/share/alterator/backends/user/module_t.backend```

## Базовый формат файла
Alterator Entry файлы записываются в кодировке UTF-8. Файл интерпретируется как последовательность регистрозависимых
 строк, разделенных символом перевода строки.

Реализации обрабатывающие файлы НЕ ДОЛЖНЫ удалять какие-либо поля из файла, даже если они их не поддерживают.
 Такие поля должны сохраняться, и если файл будет «перезаписан», они будут включены. Это гарантирует, что
 любые не стандартизированные расширения спецификации, будут сохранены, даже если другая система получит доступ к файлу
 и изменит его.

### Комментарии
Строки, начинающиеся с `#`, и пустые строки считаются комментариями и будут игнорироваться, однако их следует сохранять
 при чтении и записи файла записи рабочего стола.

Строки комментариев не интерпретируются и могут содержать любые символы (кроме LF --- перенос строки). Рекомендуется
 использовать кодировку UTF-8 для строк комментариев, содержащих символы, отличные от ASCII.

### Заголовки групп
Заголовок группы с именем ```groupname``` это строка в формате:

`[groupname]`

Имена групп могут содержать любые ASCII символы исключая `[` и `]` и управляющие символы.

Группы не могут иметь одинаковые имена.

Любые пары `{key,value}` следующие после заголовка группы принадлежат обозначенной группе, до того пока не появится
 строка с заголовком новой группы.

Базовый формат файла записи Alterator Entry требует наличия заголовка группы с именем Alterator Entry.
 В файле могут присутствовать и другие группы, но это самая важная группа, которая обязательно должна присутствовать.
 Перед этой группой в файле записи на рабочем столе не должно быть ничего, кроме, возможно, одного или нескольких комментариев.
 Эту группу также следует использовать в качестве "magic key" для автоматического определения типа MIME.

### Записи

Запись в файле это пара `{key,value}` в формате:

`Key=Value`

Пробел до и после знака равенства игнорируются; знак `=` единственный разделитель.

Только знаки `A-Za-z0-9-` могут использоваться в имени ключа.

Имена ключей регистрозависимы имя `name` и `NAME` не эквивалентны.

Несколько ключей в одной группе не могут иметь одинаковое имя. Ключи в разных группах могут иметь одинаковые имена.

## Возможные типы значений

Доступные типы значений `string, localestring, iconstring, stringlist, command, boolean, numeric`.
- Значение типа `string` может содержать любые ASCII символы исключая контрольные символы.
- Значение типа `localestring` строки отображаются пользователю, и кодируются в UTF-8.
- Значения типа `iconstring` названия иконок; могут быть абсолютные пути или символические имена для значков, определяемых с использованием алгоритма, описанного в [Спецификации темы значков](http://freedesktop.org/wiki/Standards/icon-theme-spec). Такие значения не отображаются пользователю и кодируются в UTF-8.
- Значения типа `stringlist` содершат список строк резделённых пробелом
- Значения типа `command` представляет собой почти любую bash-комманду
- Значения типа `boolean` должны быть либо строкой `true` либо `false`.
- Значения типа `numeric` должно быть валидным числовым значением с плавающей точкой как определено в `%f` спецификации для `scanf` в `C` локали.
- Значения типа `polkit.actions` зарезервировано для polkit actions.

Управляющие символы `\s, \n, \t, \r` и `\\` поддерживаются для значений типа `string, localestring` и `iconstring`
 и означают пробел, новую строку, знак табуляции, возврат каретки и косая черта соответственно.

Некоторые ключи могут иметь множественные значения. В некоторых случаях, значения ключей определено как множественное:
 для примера, `string(s)`. Множественные значения должны быть разделены `;` точкой с запятой и значения ключей могут быть
 опционально разделены точкой с запятой. Завершающие пустые строки всегда должны разделятся точкой с запятой.
 Точка с запятой как значение должна быть экранирована с использованием знака `\;`.


## Локализация значений для ключей

Ключ с типом `localestring` и `iconstring` могут содержать параметр `LOCALE`, где `LOCALE` это тип локали записи.
`LOCALE` должен быть `lang_COUNTRY.ENCODING@MODIFIER`, где `lang_COUNTRY.ENCODING` и `@MODIFIER` могут быть опущены.
Если встречается ключ с постфиксом, то тот же ключ должен присутствовать и без постфикса.

Когда читается запись файла Alterator Entry, значение ключа выбирается по сопоставлению текущей POSIX локали для значения
`LC_MESSAGES` с постфиксом `LOCALE` всех вхождений ключа с удалением части `.ENCODING`. (`LC_MESSAGES=LOCALE.ENCODING`)


Сопоставление осуществляется следующим образом. Если `LC_MESSAGES` имеет вид `lang_COUNTRY.ENCODING@MODIFIER`,
 то он будет соответствовать ключу вида `lang_COUNTRY@MODIFIER`. Если такого ключа не существует, сопоставляется
`lang_COUNTRY`, соответствующий `lang@MODIFIER`. Затем будет предпринята попытка сопоставления с `lang`.
 Если соответствующий ключ не найден, используется установленный ключ без указанной локали. Кодировка из значения
 `LC_MESSAGES` игнорируется при сопоставлении.

**Таблица 1. Сопоставление локали**

| **Значение LC_MESSAGES** | **Возможный порядок сопоставления ключей**                                        |
|:-------------------------|:----------------------------------------------------------------------------------|
| lang_COUNTRY@MODIFIER    | lang_COUNTRY@MODIFIER, lang_COUNTRY, lang@MODIFIER, lang, значение по-умолчанию   |
| lang_COUNTRY             | lang_COUNTRY, lang, значение по-умолчанию                                         |
| lang@MODIFIER            | lang@MODIFIER, lang, значение по-умолчанию                                        |
| lang                     | lang, значение по-умолчанию                                                       |

Для примера, если текущее значение `LC_MESSAGES` равно `sr_YU@Latn` и Alterator Entry файл содержит:

```
 display_name.sr_YU=...
 display_name.sr@Latn=...
 display_name.sr=...
```

Тогда значение ключа `display_name` будет взято с постфиксом `sr_YU`.

Хотя имена значков типа `iconstring` можно локализовать, они не являются удобочитаемыми строками, поэтому обычно не
 должны обрабатываться средствами перевода. Большинство приложений не должны локализовать свои значки; исключения могут
 включать значки, содержащие текст или символы, характерные для данной культуры.

## Общепринятые Alterator Entry ключи

Ключи бывают ДОПОЛНИТЕЛЬНЫМИ или ТРЕБУЕМЫМИ. Если ключ ДОПОЛНИТЕЛЬНЫЙ, он может присутствовать или отсутствовать в файле.
 Однако, если это не так, реализация стандарта не должна давать сбоев, она должна обеспечивать разумные значения по умолчанию.

Если НЕОБХОДИМЫЙ ключ действителен только в контексте другого ключа, установленного на определенное значение,
 то он должен присутствовать только в том случае, если другой ключ установлен на определенное значение. Например,
 ключ URL должен присутствовать тогда и только тогда, когда значением ключа `type` является `link`.

Несколько примеров ключей: `name.c`, `comment.ru`.

**Таблица 2. Стандартные ключи**

| **Ключ**              | **Описание**                                                                                                                                                                                                                                                                                               | **Тип значения** | **Обязательный**     |
|:----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|----------------------|
| name                  | Определенное уникальное имя сущности обозначенное в группе.                                                                                                                                                                                                                                                | string           | Да                   |
| type                  | значение определяющее тип групп, в зависимости от группы принимает различные значения.                                                                                                                                                                                                                     | string           | да для секции global |
| displayname           | отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | boolean          | нет                  |
| comment               | Однострочный комментарий-описание отображаемое для группы.                                                                                                                                                                                                                                                 | string           | Некоторые            |
| icon                  | Отображаемая специфичная иконка. Если имя представляет собой абсолютный путь, будет использоваться переданный файл. Если имя не является абсолютным путем, для поиска значка будет использоваться алгоритм, описанный в [cпецификации темы значков](http://freedesktop.org/wiki/Standards/icon-theme-spec). | string           | Нет                  |

**Таблица 2.1. <a name="additional_keys" id="additional_keys">Дополнительные ключи</a> могут быть интерпретированы в различных контекстах.**

| **Ключ**   | **Описание**                                                                                                                                                | **Тип значения** |
|:-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|
| exec       | Исполняемая команда полностью. Подробнее в разделе [exec](#ключ-exec-исполнение-запуск)                                                                     | string           |
| path       | Путь к элементу описанному в группе или рабочая директория.                                                                                                 | string           |
| terminal   | Определяет запускается ли программа в окне или терминале.                                                                                                   | boolean          |
| category   | Идентификатор категории отображаемой в интерфейсе. [[#Спецификация категорий]]. Актуально не для всех групп. Пример: samba, dhcp,DNS, webserver.            | string(s)        |
| uRL        | Присутствует если запись группа обладает URL  характеристикой                                                                                               | string           |
| started    | Состояние ресурса отражающее статус -- запущено. В случае неопределенного состояния значение так же равно false.                                            | boolean          |
| enabled    | Состояние ресурса отражающее статус -- запускается по умолчанию при старте системы. В случае неопределенного состояния значение так же равно false.         | boolean          |
| configured | Состояние ресурса отражающее статус -- сконфигурировано, конфигурация определена и валидна. В случае неопределенного состояния значение так же равно false. | boolean          |


## Ключ exec Исполнение-запуск

Ключ exec должен содержать командную строку. Командная строка состоит из исполняемой программы, за которой может
 следовать один или несколько аргументов. Исполняемую программу можно указать либо с полным путем, либо только с
 именем исполняемого файла. Если полный путь не указан, исполняемый файл ищется в переменной среды $PATH,
 используемой рабочей средой. Имя или путь исполняемой программы не могут содержать знак равенства ("=").
 Аргументы разделяются пробелом.

Аргументы передаются целиком. Если аргумент содержит зарезервированный символ, аргумент необходимо заключить
 в кавычки. Правила заключения аргументов в кавычки также применимы к имени исполняемого файла или пути к исполняемой
 программе, как передано.

Заключение в кавычки должно осуществляться путем заключения аргумента в двойные кавычки и экранирования символа двойной
 кавычки, символа обратной галочки ("\`"), знака доллара ("\$") и символа обратной косой черты ("\\"), экранируя его
 дополнительным символом обратной косой черты. Реализации должны отменить кавычки перед раскрытием кодов полей и перед
 передачей аргумента исполняемой программе. Зарезервированные символы: пробел (" "), табуляция, новая строка, двойная
 кавычка, одинарная кавычка ("'"), символ обратной косой черты ("\\"), знак "больше" (">"), знак "меньше" ("<"),
 тильда ("~"), вертикальная черта ("|"), амперсанд ("&"), точка с запятой (";"), знак доллара ("\$"), звездочка ("*"),
 вопросительный знак ("?"), решётка ("#"), круглые скобки ("(") и (")") и обратный апостроф ("\`").

Обратите внимание, что общее правило экранирование для значений строкового типа гласит, что символ обратной косой черты
 также может быть экранирован как ("\\") и что это правило экранирования применяется перед правилом кавычек. Таким
 образом, для однозначного представления символа обратной косой черты в аргументе в кавычках в файле Alterator Entry
 требуется использование четырех последовательных символов обратной косой черты ("\\\\"). Аналогично, знак доллара в
 аргументе в кавычках в файле записи рабочего стола однозначно обозначается ("\\$").

Командные строки, содержащие поля с кодом подстановки не указанные в этой спецификации, недействительны и не должны
 обрабатываться, в частности, реализации могут не обеспечивать поддержку кодов полей, не перечисленных в этой
 спецификации. Расширения, если таковые имеются, следует вводить посредством нового ключа.

Реализации должны позаботиться о том, чтобы не разрешать коды полей на несколько аргументов, если это явно не указано
 в этой спецификации. Это означает, что поля имен, имена файлов и другие замены, которые могут содержать пробелы,
 должны передаваться в качестве одного аргумента исполняемой программе после развертывания.

Хотя ключ ```exec``` определен как имеющий значение типа строки, которое ограничено символами ASCII, расширение
 кода поля может включать в аргументы символы, отличные от ASCII. Реализации должны позаботиться о том, чтобы все
 символы в аргументах, передаваемых исполняемой программе, были правильно преобразованы в соответствии с применимыми
 настройками локали.

Распознаются следующие коды:

 | **Плэйсхолдер** | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
 |:----------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
 | %o              | Имя объекта                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
 | %i              | Имя интерфейс                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
 | %f              | Одно имя файла (включая путь), даже если выбрано несколько файлов. Система, читающая запись на рабочем столе, должна распознавать, что рассматриваемая программа не может обрабатывать несколько аргументов файла, и ей, вероятно, следует создать и выполнить несколько копий программы для каждого выбранного файла, если программа не может обрабатывать дополнительные аргументы файла. Если файлы находятся не в локальной файловой системе (т. е. находятся в расположениях HTTP или FTP), файлы будут скопированы в локальную файловую систему, а %f будет расширен, чтобы указать на временный файл. Используется для программ, которые не понимают синтаксис URL. |
 | %F              | TODO Check it!: Список файлов. Используйте для приложений, которые могут открывать несколько локальных файлов одновременно. Каждый файл передается как отдельный аргумент исполняемой программе.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
 | %u              | TODO Check it!: Один URL-адрес. Локальные файлы могут передаваться как URL-адреса файлов или как путь к файлу.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
 | %U              | TODO Check it!: Список URL-адресов. Каждый URL-адрес передается как отдельный аргумент исполняемой программе. Локальные файлы могут передаваться как URL-адреса файлов или как путь к файлу.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
 | %c              | TODO Check it!: Переведенное в соответствии с локалью значение ключа ```display_name```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

## Расширение формата

Если в стандарт необходимо внести новую пару ```{ключ, значение}```, которая должна быть применима ко всем
 поддерживающим сторонам, будет проведено групповое обсуждение. Это предпочтительный метод внесения изменений. Если
 одна конкретная сторона желает добавить для личного использования, ей следует поставить перед ключом строку
 ```X-PRODUCT```, например: ```X-NewDesktop-Foo```, следуя прецеденту, установленному другими стандартами IETF и RFC.

В качестве альтернативы поля можно поместить в отдельную группу, где они могут иметь произвольные ключевые имена. В этом
 случае группа должна следовать схеме, описанной выше, то есть ```[X-PRODUCT GROUPNAME]``` или что-то подобное. Эти шаги
 позволят избежать конфликтов пространств имен между разными, но похожими средами.

## Подробнее о сущностях

### Сущность типа Application
Сущность Application описывает приложение способное отображать объекты реализующие некий интерфейс, указанный в теле данной сущности.

| **Ключ**  | **Описание**                                                                           | **Тип значения** | **Обязательный**   |
|:----------|----------------------------------------------------------------------------------------|------------------|--------------------|
| name                  | Определенное уникальное имя сущности.                                                                                                                                                                                                                                                                      | string           | Да               |
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| comment               | Однострочный комментарий-описание.                                                                                                                                                                                                                                                 | string           | Нет              |
| icon                  | Отображаемая специфичная иконка. Если имя представляет собой абсолютный путь, будет использоваться переданный файл. Если имя не является абсолютным путем, для поиска значка будет использоваться алгоритм, описанный в [cпецификации темы значков](http://freedesktop.org/wiki/Standards/icon-theme-spec). | string           | Нет              |
| interface | интерфейс, который может отображать данное приложение                                  | string           | Да                 |
| exec      | команда запуска приложения, поддерживает символы расширения `%o` и `%i`                | string           | Да                 |
| category  | категория, к которой относится приложение <!--- kozyrevid: are we sure about that? --> | string           | Нет                |

#### Примеры
* [application-example.application](../examples/applications/application-example.application)
* [alterator-object-run.application](../examples/applications/alterator-object-run.application)

### Сущность типа Category
Категории представленные типом Category призваны группировать объекты и приложения при отображении.

Базовые категории:
- СУБД
- Веб-сервер

| **Ключ** | **Описание**                                                                                                                                                     | **Тип значения**  | **Обязательный** |
|:---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------|------------------|
| name                  | Определенное уникальное имя сущности.                                                                                                                                                                                                                                                                      | string           | Да               |
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| short_display_name    | Короткое, отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| category | Необязательный ключ для обеспечения вложенности категорий.                                                                                                       | string            | Нет              |
| icon     | определяет иконку категории, в соответствии со [спецификацией freedesktop](https://specifications.freedesktop.org/icon-naming-spec/icon-naming-spec-latest.html) | string            | Нет              |
| comment  | однострочное описание категории (возможно с переводами)                                                                                                          | string            | Нет              |


#### Примеры
- [category-example1.category](../examples/categories/category-example1.category)
- [category-example2.category](../examples/categories/category-example2.category)
- [diagnostictools.category](../examples/categories/diagnostictools.category)

### Сущность типа Object
Обобщенное описание объектов для различных не типизированных сущностей. Любая
сущность описанная в формате Alterator Entry это `Object`. Сущности описанные
в спецификации с заранее определенным типом, обладают расширенным набором групп и
ключей. В случаях когда тип не указан или не определен, сущность принимает
обобщенный тип `Object` и отражает минимальный набор ключей которые
интерпретируются в зависимости от контекста.

| **Ключ**              | **Описание**                                                                                                                                                                                                                                                                                                | **Тип значения** | **Обязательный** |
|:----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|------------------|
| name                  | Определенное уникальное имя сущности.                                                                                                                                                                                                                                                                       | string           | Да               |
| display_name          | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                    | string           | Нет              |
| comment               | Однострочный комментарий-описание.                                                                                                                                                                                                                                                                          | string           | Нет              |
| icon                  | Отображаемая специфичная иконка. Если имя представляет собой абсолютный путь, будет использоваться переданный файл. Если имя не является абсолютным путем, для поиска значка будет использоваться алгоритм, описанный в [Спецификации темы значков](http://freedesktop.org/wiki/Standards/icon-theme-spec). | string           | Нет              |
| override              | Замещение другого объекта. В качестве значения указывается полное имя интерфейса, который необходимо заместить. Замещения актуальны для объектов, предоставляемых разными интерфейсами одного и того же DBUS-объекта: например имеем 2 сущности типа Backend (см ниже), имеющие одинаковое значение `name`. | string           | Нет              |

#### Замещения
Механизм замещений позволяет обозначить приоритет одного интерфейса перед другим.
Это даёт возможность заместить функционал модулей альтератора без конфликтов между новыми и старыми пакетами, которые предоставляют более одной сущности.

#### Примеры
- [objects-example.object](../examples/objects/objects-example.object)
- [apt.object](../examples/objects/apt.object)
- [repo.object](../examples/objects/repo.object)
- [rpm.object](../examples/objects/rpm.object)
- [license.object](../examples/objects/license.object) (override)

### Сущность типа Diag или Diagnostictool
Описывает диагностические инструменты. Реализации данных сущностей в форме D-Bus-объектов должны обладать возможностью 
выполнять тесты описанные в `.diag` файле, а также составлять и сохранять отчёты о результатах тестов.

Для данного типа допустимы два варианта названия: Diag и Diagnostictool, однако текущие реализации различных компонентов 
Альтератора не поддерживают полный вариант названия (допустимо только Diag). 
 
Описание диагностического инструмента включает следующие поля.

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:---------|--------------|------------------|------------------|
| name                  | Определенное уникальное имя сущности.                                                                                                                                                                                                                                                                      | string           | Да               |
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| comment               | Однострочный комментарий-описание.                                                                                                                                                                                                                                                 | string           | Нет              |
| icon                  | Отображаемая специфичная иконка. Если имя представляет собой абсолютный путь, будет использоваться переданный файл. Если имя не является абсолютным путем, для поиска значка будет использоваться алгоритм, описанный в [Спецификации темы значков](http://freedesktop.org/wiki/Standards/icon-theme-spec). | string           | Нет              |
| report_suffix | Расширение имени файла отчёта (например: `.log`, `.txt`, `.zip`, ...) | string | Да |
| assignment |Определяет назначение теста для исполнение с правами: <ul><li> System &mdash; повышенные привилегии root;</li><li>User &mdash; запуск в контексте текущего пользователя;</li><li>Universal &mdash; описываемый тест предполагает запуск в любом контексте определенном .backend; </li></ul> | string | Нет |
| tests | Словарь тестов данного диагностического инструмента, каждый тест описывается соответствующим набором полей, перечисленным в таблице [Описание теста диагностического инструмента](tests_table) | dictionary | Да |

Словарь `tests` представляет собой набор пар ключ-значение, где ключ выступает в качестве имени/идентификатора теста. Полный набор полей структуры описывающей тест представлен в (таблице)[tests_table]:
| <span id="tests_table">**Ключ**</span> | **Описание** | **Тип значения** | **Обязательный** |
|:---------|--------------|------------------|------------------|
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| comment               | Однострочный комментарий-описание.                                                                                                                                                                                                                                                 | string           | Нет              |
| icon                  | Отображаемая специфичная иконка. Если имя представляет собой абсолютный путь, будет использоваться переданный файл. Если имя не является абсолютным путем, для поиска значка будет использоваться алгоритм, описанный в [Спецификации темы значков](http://freedesktop.org/wiki/Standards/icon-theme-spec). | string           | Нет              |
| assignment |Определяет назначение теста для исполнение с правами: <ul><li> System &mdash; повышенные привилегии root;</li><li>User &mdash; запуск в контексте текущего пользователя;</li><li>Universal &mdash; описываемый тест предполагает запуск в любом контексте определенном .backend; </li></ul> | string | Нет |


#### Примеры
- [diagnostic_tool.diag](../examples/diags/diagnostic_tool.diag)
- [diagnostic_tool2.diag](../examples/diags/diagnostic_tool2.diag)

### Сущность типа Backend
Тип Backend описывает D-Bus интерфейс и его методы. На основании `.backend`-файлов содержащих Backend сущности 
`alterator-module-executor` создаст и зарегистрирует на D-Bus соответствующие интерфейсы.
Описание интерфейса может содержать следующие поля:

| **Ключ**     | **Описание**                                                                                                                                                                                                         | **Тип значения** | **Обязательный** |
|:-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|------------------|
| module       | Наименование модуля для обработки сущности типа Backend. (На данный момент только executor)                                                                                                                          | string           | Да               |
| interface    | Имя описываемого интерфейса. В качестве имени можно задать либо полное имя D-Bus интерфейса, либо короткое без символа `'.'`, в таком случае к заданному значению будет добавлен префикс `'org.altlinux.alterator.'. ` | string           | Да               |
| name         | Уникальное имя узла (объекта) в поддереве D-Bus. (к нему будет добавлен суффикс `'/org/altlinux/alterator/'`)                                                                                                          | string           | Да               |
| thread_limit | Указывает максимальное число потоков для данного интерфейса.                                                                                                                                                         | string           | Нет              |
| action_id    | Уникальный идентификатор [polkit](https://www.freedesktop.org/software/polkit/docs/latest/polkit.8.html) Если не указан, то он формируется из имени интерфейса.                                                      | string           | Нет              |
| methods | Ассоциативный массив методов данной реализации интерфейса. Поля используемые при описании методов перечисленны [ниже](methods_table) | dictionary | Да |

Таблица `methods` описывает методы данного интерфейса. Каждый ключ таблицы должен совпадать с именем метода, а соответствующее ему значение описывает метод с соответствующим именем. Имя метода может состоять только из латинских букв, цифр и символа подчёркивания. Пробелы не допускаются. Содержимое секции зависит от модуля который будет обрабатывать запрос. Ниже представлен список полей для модуля executor.

| <span id=methods_table>**Ключ**</span>                                                            | **Описание**                                                                                                                                                                                                                                                                                                                                                                                      | **Тип значения**                                                                           | **Обязательный** |
|:--------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|------------------|
| execute                                                             | Команда bash исполняемая при вызове метода, параметры метода обозначаются фигурными скобками (например, `ls {dir}`).                                                                                                                                                                                                                                                                              | string                                                                                     | Да               |
| stdout_strings<br/>stdout_bytes                                     | С помощью этих полей можно включить возможность возврата массива строк или массива байт из stdout . Для этого полю нужно задать значение enabled. Если включен возврат массива байт, то возврат строк отключается (в том числе сигналами).                                                                                                                                                        | Только enabled                                                                             | Нет              |
| stderr_strings                                                      | Позволяет выводить строк из stderr.                                                                                                                                                                                                                                                                                                                                                               | Только enabled                                                                             | Нет              |
| stdout_byte_limit<br/>stdout_strings_limit<br/>stderr_strings_limit | Максимальный размер в байтах для соответствующего массива. Значение по умолчанию 524288.                                                                                                                                                                                                                                                                                                          | Допустимый диапазон - от 0 до 2147483647. Работа с массивами больше 524288 не проверялась. | Нет              |
| stdout_signal_name                                                  | Имя сигнала, в который будет перенаправлен stdout.                                                                                                                                                                                                                                                                                                                                                | string                                                                                     | Нет              |
| stderr_signal_name                                                  | Имя сигнала, в который будет перенаправлен stderr.                                                                                                                                                                                                                                                                                                                                                | string                                                                                     | Нет              |
| action_id                                                           | Уникальный идентификатор polkit для метода.                                                                                                                                                                                                                                                                                                                                                       | string                                                                                     | Нет              |
| timeout                                                             | Промежуток времени по истечении которого процессу, порождённому для выполнения данного метода, будет отправлен сигнал SIGKILL. Время задаётся в секундах. Значение по умолчанию - 60 секунд. Если значение поля timeout ноль или меньше, то timeout не задаётся и сигнал SIGKILL не будет отправлен. Если значение задано не корректно - timeout не задаётся и сигнал SIGKILL не будет отправлен. | numeric                                                                                    | Нет              |
| thread_limit | Ограничение на количество тредов для метода, т.е. сколько экземпляров этого метода можно запустить параллельно. Значение по умолчанию - 1. | numeric | Нет |

Подробное описание [тут](https://gitlab.basealt.space/alt/alterator-manager/-/blob/master/docs/README-ru.md).

#### Примеры
- [autogenerated-legacy-net-eth.backend](../examples/backends/autogenerated-legacy-net-eth.backend)
- [backend-example.user.backend](../examples/backends/backend-example.user.backend)

### Сущность типа Component

Сущности данного типа описывают компоненты операционной системы состоящие из множества пакетов и позволяющие выполнять 
некоторую последовательность действий (deploy) после установки. 

`[Alterator Entry]` типа Component содержит следующие поля:

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:-|-|-|-|
| name                  | Определенное уникальное имя сущности.                                                                                                                                                                                                                                                                      | string           | Да               |
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| short_display_name    | Короткое, отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| comment               | Однострочный комментарий-описание.                                                                                                                                                                                                                                                 | string           | Нет              |
| icon                  | Отображаемая специфичная иконка. Если имя представляет собой абсолютный путь, будет использоваться переданный файл. Если имя не является абсолютным путем, для поиска значка будет использоваться алгоритм, описанный в [Спецификации темы значков](http://freedesktop.org/wiki/Standards/icon-theme-spec). | string           | Нет              |
| category | Имя категории к которой относится компонент | string | Нет |
| arches | Список поддерживаемых компонентом архитектур | stringlist | Нет |
| packages | Список пакетов, содержащихся в данной компоненте | dictionary | да |

Каждый пакет из массива `packages` может обладать 4-мя опциональными полями:
| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:-|-|-|-|
| meta | Булево поле принимающее значение `true` если пакет является мета-пакетом. Значение по умолчанию &mdash; `false` | boolean | Нет |
| arch | Список архиректур на которых данный пакет доступен. Данное поле может содержать любое подмножество списка поддерживаемых ALT архитектур. | stringlist | Нет |
| exclude_arch | Список архиректур на которых данный пакет доступен. Данное поле может содержать любое подмножество списка поддерживаемых ALT архитектур. | stringlist | Нет |
| desktop | Список окружений рабочего стола, для которых рекомендован данный пакет. Данное поле может содержать любое подмножество списка поддерживаемых ALT окружений рабочего стола. | stringlist | Нет |

Если поля `arch` и `exclude_arch` содержат какие-либо строки кроме перечисленных ниже то `Alterator Entry` не будет провалидирована.
* `aarch64`
* `E2K`
* `IA32`
* `mipsel`
* `ppc64`
* `s390x`
* `x86_64`
* `X86`
* `riscv64`
* `loongarch64`

Так же если поле `desktop` содержbт какие-либо строки кроме перечисленных ниже то `Alterator Entry` не будет провалидирована.
* `CINNAMON`
* `GNOME`
* `KDE5`
* `KDE6`
* `MATE`
* `XFCE`

#### Примеры

- [example1.component](../examples/components/example1.component)
- [example1.component](../examples/components/example2.component)


### Сущность типа Edition

`Alterator Entry` типа `Edition` описывают распространяемые редакции дистрибутива.

Описание сущности данного типа включает следующие поля:

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:-|-|-|-|
| name                  | Определенное уникальное имя сущности.                                                                                                                                                                                                                                                                      | string           | Да               |
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| license | Лицензия под которой распространяется данная редакция | string | Нет |
| arches | Список архитектур для которых доступна данная редакция, список должен содержать только элементы следующего списка:<ul><il>`aarch64`</il><il>`E2K`</il><il>`IA32`</il><il>`mipsel`</il><il>`ppc64`</il><il>`s390x`</il><il>`x86_64`</il><il>`X86`</il><il>`riscv64`</il><il>`loongarch64`</il></ul> Если в списке встречается любое другое значение `Alterator Entry` не будет провалидирована | stringlist | Нет |
| kflavours | Разновидность ядра используемая в данной редакции | string | Нет |
| sections | Асоциативный массив разделов, разбивающий список компонент на несколько деревьев, для более наглядного отображения в пользовательском интерфейсе. Примерами таких разделов можно считать разделение набора компонент издания на секцию дазового ПО и секцию дополнительного ПО | dictionary | Да |
| languages | Это поле используется для описания языковых модулей для приложений поставляемых вместе с редакцией | stringlist | Нет |
| desktop_environment | Окружение рабочего стола поставляемое вместе с данной редакцией | string | Нет |


### Сущность типа Service

**Примеры сервисов**
- Samba
- Bind
- Dhcp; Kea Dhcp;
- Krb5;
- MySQL; PostgreSQL(1C); MariaDB;
- Apache; Nginx;

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:---------|--------------|------------------|------------------|
| name                  | Определенное уникальное имя сущности.                                                                                                                                                                                                                                                                      | string           | Да               |
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| comment               | Однострочный комментарий-описание.                                                                                                                                                                                                                                                 | string           | Нет              |
| icon                  | Отображаемая специфичная иконка. Если имя представляет собой абсолютный путь, будет использоваться переданный файл. Если имя не является абсолютным путем, для поиска значка будет использоваться алгоритм, описанный в [Спецификации темы значков](http://freedesktop.org/wiki/Standards/icon-theme-spec). | string           | Нет              |
| enable_force_deploy   | Разрешить вызов `Deploy()` на задеплоенном сервисе.  | boolean          | Нет              |
| parameters | Словарь параметров нужных для развёртки, восстановления, бэкапа данного сервиса сервиса, поля описывающие параметры будут перечисленны далее. | dictionary | да |
| resources | Словарь содержащий информацию о ресурсах который использует сервис (файлы конфигурации, пути к рабочим директориям, systemd сущности, порты). | dictionary | нет |
| diag_tools | Словарь содержащий информацию о дополнительных тестовых инструментах | dictionary | нет |


**Описание дополнительных тестовых инструментов**

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:---------|--------------|------------------|------------------|
| bus      | шина (session/system) | string  | да               |
| path     | DBus path тестового инструмента | string  | да     |


**Описание параметров**

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:---------|--------------|------------------|------------------|
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| comment               | Однострочный комментарий-описание.                                                                                                                                                                                                                                                 | string           | Нет              |
| type | Тип параметра, может принимать значения: `string`, `boolean`, `integer`, `enum`, `array`, `object`. Параметр типа `object` обязательно должен содержать одно из полей `prototype` или `properties` (см ниже). | string | да |
| password | Скрывать введённый текст. Только для `type = string` | boolean | нет |
| array_type | Тип элементов массива (для `type = array`), может принимать значения: `string`, `integer`, `enum`, `object`. | string | нет |
| array_min | Минимальный размер массива (для `type = array`) | integer | нет |
| array_max | Максимальный размер массива (для `type = array`) | integer | нет |
|values| Список значений для типа параметрв `enum`. Каждое значение должно содержать локализованное поле `display_name`. | dictionary | нет |
| pattern | Регулярное выражение для типа параметрв `string`. | string | нет |
| min | Минимальное значение для типа параметров `integer`. | integer | нет |
| max | Максимальное значение для типа параметров `integer`. | integer | нет |
|default| Значение по умолчанию для параметра. | string | нет |
| constant | Параметр является константой. Обычно такие параметры скрыты, за исключением дочерних параметров группы (см. ниже). | boolean | нет |
| context | Контекст параметра, то в каком сценарии используется параметр, может принимать значения: `deploy`, `configure`, `restore`, `backup`, `diag`, `status`. | stringlist | да |
| required | Определяет обязательность указания параметра в каждом из контекстов | stringlist | нет |

**Особые поля для параметров типа `object`**

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:---------|--------------|------------------|------------------|
| properties| Словарь дочерних параметров. Параметры не могут содержать `context`, а тип `required` становится `boolean` | dictionary | если не задано `prototype` |
| exclusive | Считать данный составной параметр "группой" (только если не задано `prototype`). Группа позволяет выбрать лишь один из дочерних параметров. Параметры с `constant=true` служат аналогом значений `enum`, а при `constant=false` выбранный параметр можно радактировать. Параметры не могут иметь `required`. | boolean | нет |
| prototype | Использовать другой параметр в качестве прототипа (только для `type = object`). В таком случае параметр будет содержать те же дочерние параметры, что и его "прототип". Допустимы только имена параметров, описанных в таблице `parameters` сервиса. | string | если не задано `properties` |


**Описание ресурсов**

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:---------|--------------|------------------|------------------|
| display_name           | Отображаемое в графическом интерфейсе имя, удобочитаемое предполагает наличие переводов.                                                                                                                                                                                                                   | string           | Нет              |
| comment               | Однострочный комментарий-описание.                                                                                                                                                                                                                                                 | string           | Нет              |
| type | Тип ресурса, может принимать значения: `file`, `directory`, `systemd_unit`, `port`.| string| да |
| path | Путь к файлу или директории, для типов `file` и `directory`. Поля описывающие свойства будут перечисленны далее. | dictionary | да |
| unit_name | Имя systemd юнита, для типа `systemd_unit`. Поля описывающие свойства будут перечисленны далее. | dictionary | да |
| inet_service | Номер порта, для типа `port`. Поля описывающие свойства будут перечисленны далее. | dictionary | да |
| tcp | Используется ли протокол tcp. | boolean | да |
| udp | Используется ли протокол udp. | boolean | да |

**Описание свойств ресурсов**

| **Ключ** | **Описание** | **Тип значения** | **Обязательный** |
|:---------|--------------|------------------|------------------|
| value    | Значение свойства | `integer` для `inet_service`, для остальных - `string` | да |
| parameter| Привязка параметра к свойству ресурса, которое может быть переопределено, для отображения переопределённого через параметр значения. Влияет на отображение при получении статуса - во вкладке ресурсов может быть указана соотвествующая пометка  | string | нет |

#### Примеры
- [Пример сервиса](../examples/service/example1.service)

## Объект /org/altlinux/alterator/global
Интерфейс categories

Интерфейс categories объекта global служит для получения информации о категориях объектов Alterator. Для работы необходимо установить пакет `alterator-module-categories`.

Интерфейс categories включает в себя 2 метода:

- `List` — возвращает список всех существующих категорий;
- `Info` — принимает на вход имя категории и возвращает всю информацию об этой категории в формате Alterator Entry типа Category, либо пустое сообщение с кодом возврата 1, если такой категории не существует.

Интерфейс applications

Интерфейс applications объекта global служит для получения информации о локально установленных приложениях. Для работы необходимо установить пакет `alterator-module-applications`.

Интерфейс applications включает в себя 2 метода:

- `List` — возвращает список всех локально установленных приложений, доступных через D-Bus;
- `Info` — принимает на вход имя приложения и возвращает всю информацию о нём в формате Alterator Entry типа Application, либо пустое сообщение с кодом возврата 1, если такого приложения не существует.
