#!/bin/sh

FACILITIES_DIR=/etc/control.d/facilities
CONTROL=/usr/sbin/control
ENTRY_PATH=/usr/share/alterator/control
GENERATED_ENTRY_PATH=/etc/alterator/control
AUTOGEN_PREFIX="autogenerated-control-"

control(){
    $CONTROL $@
}

case "$1" in
    list-facilities) ls $FACILITIES_DIR ;;

    batch-info)
        ls $FACILITIES_DIR | while read facility
        do
            $0 info $facility && printf '\0' ||
            echo "skipping missing facility" > /dev/stderr
        done
    ;;

    info)
        cat $ENTRY_PATH/$2.control ||
        cat $GENERATED_ENTRY_PATH/$AUTOGEN_PREFIX$2.control ||
        echo $2 not found > /dev/stderr
    ;;

    status)
        control $2 status | xargs echo -n
    ;;

    list-states)
        control $2 list | tr ' ' $'\n'
    ;;


    *)
        echo "unknown command" > /dev/stderr
        exit 1
    ;;
esac
