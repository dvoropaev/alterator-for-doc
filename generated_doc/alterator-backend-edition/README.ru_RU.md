**alterator-backend-edition**

[Русский](README.ru_RU.md)

Предназначен для управления сведениями о редакциях дистрибутива и публикации их через интерфейс Alterator.

---

# Общие сведения
| Компонент | Расположение | Назначение |
| --------- | ------------ | ---------- |
| Скрипт `edition` | `/usr/lib/alterator/backends/edition` | Управляет текущей редакцией и предоставляет доступ к файлам описаний. |
| Файл `current_edition.backend` | `/etc/alterator/backends/current_edition.backend` | Реализует backend интерфейса `org.altlinux.alterator.current_edition1`. |
| Каталог `/usr/share/alterator/editions` | TOML-файлы `.edition` | Хранилище описаний редакций, используемое при поиске сведений. |
| Каталоги `/usr/share/distro-licenses`, `/usr/share/alt-notes` | HTML-файлы лицензий и заметок | Резервные источники данных для команд `license`, `release-notes`, `final-notes`. |

# Возможности
- Чтение TOML-описаний редакций и выдача их содержимого (`edition info`).
- Получение путей к описанию, лицензии, релизным и финальным заметкам редакции.
- Определение текущей редакции по `/etc/os-release` либо по ключу `/{org/altlinux/product/edition}/current` в dconf.
- Переключение активной редакции с обновлением `/etc/dconf/db/distr` и полей `VARIANT/VARIANT_ID` в `/etc/os-release`.
- Восстановление данных (`edition recover`) при рассинхронизации источников.

# Интеграция с другими компонентами
- Метод `systeminfo.d/notes` из пакета `alterator-backend-systeminfo` вызывает `edition` для получения путей к лицензии и заметкам.
- После изменения редакции скрипт компилирует базу dconf и обновляет системный профиль, что обеспечивает корректную работу графических клиентов Alterator.
- Возвращаемые HTML-файлы лицензий могут находиться в каталоге `distro-licenses`, что согласовано с пакетом `alterator-backend-edition-utils`.

# Обработка ошибок
| Код | Значение | Действие |
| --- | -------- | -------- |
| `0` | Операция выполнена успешно. | Вывод запрошенных данных на stdout. |
| `101` | Текущая редакция не определена. | Скрипт завершает работу с сообщением `Error: edition not set`. |
| `102` | Файл `.edition` не найден. | Возвращается сообщение `Error: edition '<имя>' not found`. |
| `201` | Файл описания/лицензии отсутствует. | Завершение с `Error: file '<entity>' not found`. |

# Порядок использования
1. Получить список доступных редакций: `edition list`.
2. Просмотреть сведения выбранной редакции: `edition info <name>` или `edition description <name>`.
3. Назначить текущую редакцию: `edition set <name>` и убедиться, что `edition get` возвращает новое значение.
4. При нарушении данных выполнить `edition recover` и перепроверить `edition info`.

# Документация по интерфейсам
- `current_edition1` — предоставляет методы получения сведений о редакции и переключения активного выпуска. См. [current_edition1.md](./current_edition1.md).
