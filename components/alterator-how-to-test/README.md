# Небольшая инструкция по тестированию Альтератора на DBus

## Вступление

> Текущее состояние Альтератора на DBus крайне далеко от идеала. Предполагаемые
> здесь тесты служат не только для проверки сохранения работоспособности всех
> функций при обновлениях, но и для выявления проблем уже сейчас. То есть нам
> известно о том, что текущее поведение будет отличаться от описанного здесь и
> планируем это исправлять.
>
> Так как у этого проекта ещё нет никаких пользователей, мы предполагаем
> большое число проблем, с которыми мы просто не успели ещё столкнуться, и
> надеемся, что этот процесс тестирования поможет выявить их пораньше.

- Это описание доступно на GitLab, в организации, где и ведётся вся
  разработка: https://altlinux.space/alterator/alterator-how-to-test.
- По всем вопросам можно обращаться к cherniginma@basealt.ru или создавать
  issue в соответствующем репозитории.

## Включаемые пакеты

Для тестирования необходимо установить следующие пакеты:

- alterator-explorer
- alterator-application-packages
- alterator-application-components

> В ближайшем будущем добавится ещё cli интерфейс alteratorctl, но на данный
> момент он не готов

По зависимостям также притянутся:

- alterator-interface-legacy
- alterator-backend-legacy
- alterator-interface-categories
- alterator-backend-categories
- alterator-interface-packages
- alterator-backend-packages
- alterator-interface-component
- alterator-interface-component_categories
- alterator-backend-component_categories

На данный момент все эти пакеты в своих последних версиях доступны в Сизифе. А
также в задаче для p11 #352638.

```bash
sudo apt-repo add 352638
sudo apt-get update
sudo apt-get install alterator-browser alterator-application-packages alterator-application-components
```

## Ожидаемое состояние

### Состояние сервиса org.altlinux.alterator на системной шинe DBus

> В целом, это состояние может и будет меняться при разработке в будущем, даже
> уже ближайшем и не требует четкого соответствия всему, что будет идти ниже.
> Однако выявление проблем на DBus позволит быстрее выявлять понимать, что
> конкретно могло сломаться. Поэтому я описываю его состояние тут.

1.  Объекты для управления модулями старого альтератора (из пакета
    alterator-backend-legacy):

    - /org/altlinux/alterator/datetime
    - /org/altlinux/alterator/license
    - /org/altlinux/alterator/net_wifi
    - /org/altlinux/alterator/users
    - и многие другие

    Все эти объекты должны реализовывать интерфейс org.altlinux.alterator.legacy1.

    Так же должен быть доступен объект /org/altlinux/alterator/legacy_runner,
    реализующий интерфейс org.altlinux.alterator.application1, который будет
    использоваться для запуска старых модулей

2.  Объект /org/altlinux/alterator/global с интерфейсами:

    - org.altlinux.alterator.categories1, который предоставляет доступ к списку
      категорий объектов и информации о них.
    - org.altlinux.alterator.component_categories1, который предоставляет
      доступ к списку компонентов и информации о них.

3.  Объекты для управления пакетами (из пакета alterator-backend-packages):

    - /org/altlinux/alterator/apt
    - /org/altlinux/alterator/rpm
    - /org/altlinux/alterator/repo

    На данный момент каждый из этих объектов реализует свой интерфейс:
    org.altlinux.alterator.apt1, org.altlinux.alterator.rpm1 и
    org.altlinux.alterator.repo1, соответственно. А также интерфейс
    org.altlinux.alterator.application1 для отображения в Alterator Browser.

4.  Объекты компонент, такие как:

    - /org/altlinux/alterator/component_centaurus_samba
    - /org/altlinux/alterator/component_centaurus_xorg
    - /org/altlinux/alterator/component_centaurus_mate
    - /org/altlinux/alterator/component_centaurus_jitsi_meet
    - и многие другие

    Все эти объекты должны реализовывать интерфейс
    org.altlinux.alterator.component1.

### Тестирование alterator-explorer

Установка пакета alterator-explorer заменяет acc, однако доступ к старому acc ещё можно получить с помощью acc-legacy.
Новое приложение acc должно во многом повторять внешний вид acc-legacy.

1.  Здесь должны быть доступны все те же объекты, что и в acc-legacy, в тех же
    категориях.
2.  Порядок категорий должен быть такой же, как и в acc-legacy.
3.  У всех категорий должны быть соответствующие иконки.
4.  При запуске старых модулей, они должны открываться через
    alterator-standalone в отдельном окне.
5.  Кроме старых объектов, должны отображаться и новые, предназначенные для
    управления пакетами и компонентами. Они должны существовать в отдельной
    категории.
6.  При запуске модулей управления пакетами должно открываться приложение
    alterator-application-packages с уже открытым разделом (apt/rpm/repo).
7.  При запуске приложения управления компонентами должно открываться
    приложение alterator-application-components.
8.  Кнопка открытия старой версии, должна запускать acc-legacy.

> Известные нам проблемы: https://altlinux.space/alterator/alterator-explorer/issues

### Тестирование alterator-application-packages

На данный момент это приложение предоставляет графический интерфейс для
управления пакетами и репозиториями, разделяя весь функционал на 3 раздела:
rpm, apt и repo.

1.  Тестирование раздела rpm.
    1.  При открытии alterator-application-packages в разделе rpm должна
        отображаться таблица со списком установленных пакетов.
    2.  Пока фокус не лежит на каком-либо пакете, должны быть неактивны кнопки,
        выполняющие действия с конкретным пакетом: Файлы, Информация и Удалить.
        При выделении пакета, кнопки должны становиться активными.
    3.  При нажатии на кнопку Файлы должно открываться окно со списком файлов
        в пакете.
    4.  При нажатии на кнопку Информация должно открываться окно с информацией
        о пакете.
    5.  При нажатии на кнопку Удалить должен спрашиваться пароль администратора
        и в последствии, пакет должен удаляться, если от него не зависят
        другие. Если же есть пакеты, зависящие от него, то должна быть выдана
        соотвествующая ошибка.
2.  Тестирование раздела apt.
    1.  При открытии alterator-application-components в разделе apt должна
        отображаться таблица со списком всех доступных пакетов.
    2.  В колонке "Установлен" должны стоять галочки для установленных пакетов.
    3.  При изменении состояния пакетов, изменённые строки должны выделяться
        другим цветом.
    4.  При нажатии применить, должны устанавливаться/удаляться пакеты,
        состояние которых изменилось.
    5.  Кнопка Обновить должна обновлять список пакетов.
3.  Тестирование раздела repo.
    1.  При открытии alterator-application-components в разделе repo должна
        отображаться таблица со списком всех доступных репозиториев.
    2.  По кнопке Новый репозиторий должна открываться окно добавления нового
        репозитория.
    3.  По кнопке Удалить репозиторий должно производиться удаление выбранного
        репозитория.

> Известные нам проблемы: https://altlinux.space/alterator/alterator-application-packages/issues

### Тестирование alterator-application-components

Это приложение предоставляет графический интерфейс для управления компонентами.

1.  При открытии alterator-application-components должно отображаться дерево
    с компонентами. На верхнем уровне дерева должны быть категории, в них
    компоненты или подкатегории.
2.  При отсутствии изменений состояния компонент в дереве, кнопки Сбросить и
    Применить должны быть неактивными. При появлении изменений эти кнопки
    должны становиться активными.
3.  Изменённые компноненты и категории должны выделяться другим цветом.
4.  При выборе (клике на чекбокс) компоненты или компоненты, изменения должны
    влиять и на состояния родительской категории (если она есть), и на дочерние
    категории/компоненты.
5.  На правой половине окна должно отображаться описание выбранного компонента.
6.  По нажатию Применить в диалоговом окне должно спрашиваться, согласие на
    применение изменений и приводится список устанавливаемых и удаляемых
    пакетов.

> Известные нам проблемы: https://altlinux.space/alterator/alterator-application-components/issues
