# Глава 4. Сервисный стек
Сервисный стек — набор компонентов, обеспечивающих развертывание и управление прикладными сервисами через Alterator.

## Интерфейс org.altlinux.alterator.service1
Возможности:
- `Info () -> (Array[Byte] stdout_bytes, Int32 response)` — возвращает описание сервиса в формате `.service`.
- `Deploy (String stdin) -> (Int32 response)` — выполняет развертывание, получает параметры в стандартном вводе.
- `Configure (String stdin) -> (Int32 response)` — применяет новую конфигурацию уже развернутого сервиса.
- `Start () -> (Int32 response)` и `Stop () -> (Int32 response)` — управляют системными юнитами сервиса.
- `Undeploy (String stdin) -> (Int32 response)` — удаляет развёрнутый сервис.
- `Backup (String stdin) -> (Int32 response)` и `Restore (String stdin) -> (Int32 response)` — операции резервного копирования.
- `Status () -> (Array[Byte] stdout_bytes, Int32 response)` — сообщает состояние сервиса и способ развертывания.
- Сигналы `service_stdout_signal(String)` и `service_stderr_signal(String)` транслируют вывод helper-процессов построчно.

## Структура пакета сервиса
Требуется:
- Файл `<имя>.service` — описывает параметры, ресурсы, локализацию (см. главу 2).
- Файл `<имя>.backend` — определяет интерфейс D-Bus и связывает методы с helper.
- Helper `<имя>-helper` — исполняемый файл, принимающий команды (`deploy`, `configure`, `start`, `stop` и т.п.).
- Дополнительно: файлы диагностики (`.diag`), компоненты UI (`.component`), unit-файлы systemd, шаблоны конфигураций.

## Пример каталога
Организация:
- `alterator-service-chrony/` и `alterator-service-samba-share/` показывают реализацию боевых сервисов.
- `alterator-test-services/` содержит учебные директории `test_service1`…`test_service4`, шаблоны `.backend` и helper `test-services-helper`.
- Подкаталог `schema-generator/` демонстрирует генерацию схем параметров и статических файлов.

## Жизненный цикл сервиса
Порядок:
1. Пользователь выбирает сервис через UI (описание берётся из `.service`).
2. Клиент отправляет параметры в метод `Deploy`; helper выполняет развёртывание и сообщает результат через stdout/stderr и код возврата.
3. Метод `Start` активирует systemd-юниты, перечисленные в `resources`.
4. Метод `Configure` обновляет параметры, используя тот же helper.
5. Метод `Status` возвращает текущее состояние; UI отображает вкладки «Параметры» и «Ресурсы» на основе `.service`.
6. При необходимости выполняются `Backup`/`Restore` и `Undeploy`.

## Проверка корректности
Рекомендации:
- Убедиться, что helper возвращает коды: `0` — успех, `!=0` — ошибка.
- Проверять, что ресурсы из секции `resources` совпадают с фактически создаваемыми файлами и юнитами.
- Тестировать сервисы на стенде с `alterator-test-services`, чтобы подтвердить совместимость с UI и менеджером.
- Вести изменения helper-скриптов и описаний синхронно, иначе UI отобразит неверные поля.
